<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Business Search with Suggestions</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    input[type="text"] {
      width: 300px;
      padding: 8px;
      font-size: 16px;
      margin-bottom: 10px;
    }
    .suggestions {
      border: 1px solid #ccc;
      max-height: 200px;
      overflow-y: auto;
      width: 300px;
      position: absolute;
      background: #fff;
      z-index: 999;
    }
    .suggestion-item {
      padding: 8px;
      cursor: pointer;
    }
    .suggestion-item:hover {
      background: #f0f0f0;
    }
  </style>
</head>
<body>

  <h2>Search Business</h2>

  <!-- Searchbox for business name -->
  <label>Search Business Name:</label><br>
  <input type="text" id="searchBox" placeholder="Type business name...">
  <div id="suggestions" class="suggestions" style="display:none;"></div>

  <!-- Fields to populate -->
  <div style="margin-top:20px;">
    <label>Business Name:</label><br>
    <input type="text" id="businessNameField" readonly><br>

    <label>Business Address:</label><br>
    <input type="text" id="businessAddressField" readonly><br>

    <input type="hidden" id="businessTypeField">
  </div>

  <script>
    // Fetch store data from API, passing query as a parameter
    const detailsUrl = `http://localhost:8001/api/service/concernslist/business`;
        
    fetch(detailsUrl)
      .then(response => response.json())
      .then(data => {
        const searchBox = document.getElementById('searchBox');
        const suggestionsBox = document.getElementById('suggestions');
        const businessNameField = document.getElementById('storeName');
        const businessAddressField = document.getElementById('storeAddress');
        const businessTypeField = document.getElementById('businessTypeField');

        searchBox.addEventListener('input', function() {
          const query = this.value.toLowerCase();
          suggestionsBox.innerHTML = '';
          if (query.length === 0) {
            suggestionsBox.style.display = 'none';
            businessTypeField.value = 'None';
            return;
          }

          const filtered = data.filter(item =>
            item.business_name.toLowerCase().includes(query)
          );

          if (filtered.length > 0) {
            filtered.forEach(item => {
              const div = document.createElement('div');
              div.classList.add('suggestion-item');
              div.innerHTML = `<strong>${item.business_name}</strong><br><small>${item.business_address}</small>`;
              div.addEventListener('click', () => {
                searchBox.value = item.business_name;
                businessNameField.value = item.business_name;
                businessAddressField.value = item.business_address;
                businessTypeField.value = item.business_type;

                // Make fields non-editable again
                businessNameField.readOnly = true;
                businessAddressField.readOnly = true;
                suggestionsBox.style.display = 'none';
              });
              suggestionsBox.appendChild(div);
            });
            suggestionsBox.style.display = 'block';
          } else {
            const noResult = document.createElement('div');
            noResult.classList.add('suggestion-item');
            noResult.textContent = 'No records found.';
            noResult.addEventListener('click', () => {
              // Clear the fields when "No records found" is selected
              businessNameField.value = '';
              businessAddressField.value = '';
              businessNameField.readOnly = false;
              businessAddressField.readOnly = false;
              businessTypeField.value = 'None';
              suggestionsBox.style.display = 'none';
            });
            suggestionsBox.appendChild(noResult);
            suggestionsBox.style.display = 'block';
            businessTypeField.value = 'None';
          }
        });

        // Close suggestions when clicking outside
        document.addEventListener('click', function(e) {
          if (e.target !== searchBox) {
            suggestionsBox.style.display = 'none';
          }
        });
      })
      .catch(error => console.error('Error fetching data:', error));
  </script>

</body>
</html>
